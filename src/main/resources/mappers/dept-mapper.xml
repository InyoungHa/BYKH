<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="deptMapper">
	<!--부서 테이블 -->
	<resultMap type="com.bykh.groupware.dept.vo.DeptVO" id="dept">
		<id column="DEPTNO" 					property="deptno"/>
		<result column="DENAME" 				property="dename"/>
		<result column="LOC"					property="loc"/>
		<result column="IS_USE"					property="isUse"/>

	</resultMap>
	
	<!--부서 등록 쿼리  -->
	<insert id="insertDept">
		INSERT INTO DEPT (DEPTNO
						, DENAME
						, LOC)
				VALUES ((SELECT TO_NUMBER(DECODE(#{loc}, '서울', '10', '인천', '20', '부산', '30', '여수', '40') || NVL(MAX(TO_NUMBER(SUBSTR(DEPTNO, 3))), 0) + 1) 
						FROM DEPT WHERE LOC = #{loc})
						, #{dename}
						, #{loc}
		)
	</insert>
	

	<!--부서 목록 조회  -->
	<select id="selectDeptList" resultMap="dept">
		SELECT DEPTNO
			, (REPLACE(TRIM(DENAME), ' ', '')) AS DENAME
			, LOC
			, IS_USE
		FROM DEPT	
		ORDER BY DEPTNO DESC
	</select>
<!-- 		OFFSET #{offsetCnt} ROWS FETCH FIRST #{displayCnt} ROWS ONLY -->
	
	<!--부서 등록 중복검사  -->
	<select id="isDulicateDept" resultType="int">
		SELECT COUNT(DENAME)			
		FROM DEPT
		WHERE LOC =#{loc}
		AND DENAME =#{dename}
	</select>
	
	<!--부서 삭제  -->
	<delete id="deleteDept">
		DELETE DEPT
		WHERE DEPTNO =#{deptno}
	</delete>
	
	<!--부서 사용 여부 변경  -->
	<update id="updateIsUse">
		UPDATE DEPT
		SET IS_USE = DECODE(IS_USE, 'Y','N','N','Y')
		WHERE DEPTNO = #{deptno}
	</update>

	
</mapper>



























