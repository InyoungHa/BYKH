<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="empMapper">
	<!--사원 테이블 -->
	<resultMap type="com.bykh.groupware.emp.vo.EmpVO" id="emp">
		<id column="EMPNO" 					property="empno"/>
		<result column="DEPTNO" 				property="deptno"/>
		<result column="ENAME"					property="ename"/>
		<result column="EPW"					property="epw"/>
		<result column="E_JOB" 					property="eJob"/>
		<result column="AGE" 					property="age"/>
		<result column="GENDER" 				property="gender"/>
		<result column="E_EMAIL" 				property="eEmail"/>
		<result column="PHONE_TEL" 				property="phoneTel"/>
		<result column="OFFICE_TEL" 			property="officeTel"/>
		<result column="E_ROLE" 				property="eRole"/>
		<result column="E_STATUS" 				property="eStatus"/>
		<result column="JOIN_DATE" 				property="joinDate"/>

	
		<result column="E_STATUS_STR" 				property="eStatusStr"/>
		
		<!-- 테스트용 임시 추가 - 희수 -->
		<result column="LEVEL" 				property="level"/>
		<association property="deptVO" resultMap="deptMapper.dept"></association>


	</resultMap>
	
	<!--사원 이미지 테이블  -->
	<resultMap type="com.bykh.groupware.emp.vo.EImgVO" id="eImg">
		<id column="IMG_CODE" 				property="imgCode"/>
		<result column="EMPNO" 					property="empno"/>
		<result column="ORIGIN_FILE_NAME" 		property="originFileName"/>
		<result column="ATTACHED_FILE_NAME" 	property="attachedFileName"/>
		
	</resultMap>	
	
	
	<!--사원 등록  -->
	<insert id="insertEmp">
		INSERT INTO EMP(EMPNO
						, ENAME
						, EPW
						, JOIN_DATE
						, DEPTNO
						, E_JOB
						, E_STATUS)
				VALUES(TO_CHAR(SYSDATE, 'YY') || #{deptno} || 
						LPAD((SELECT COUNT(*) + 1 FROM EMP WHERE DEPTNO = #{deptno}), 2, '0')
						, #{ename}
						, #{epw}
						, #{joinDate}
						, #{deptno}
						, #{eJob}
						, #{eStatus}
						)
	</insert>
	
	<!--사원 조회  -->
	<select id="selectEmpList" resultMap="emp">
		SELECT EMPNO
			, (REPLACE(TRIM(ENAME),' ', '')) AS ENAME	
			, EPW
			, TO_CHAR(JOIN_DATE, 'YYYY-MM-DD') AS JOIN_DATE
			, (SELECT DENAME FROM DEPT WHERE DEPTNO=EMP.DEPTNO) AS DENAME
			, E_JOB
			, CASE E_STATUS
				WHEN 1 THEN '재직중'
				WHEN 2 THEN '휴직'
				WHEN 3 THEN '퇴직'
				ELSE '알 수 없음'
			  END AS E_STATUS_STR	
			, DECODE(E_ROLE, 'USER', '직원','ADMIN','관리자','SUPER_ADMIN','최종 관리자') AS E_ROLE
		FROM EMP	
		ORDER BY EMPNO DESC
		OFFSET #{offsetCnt} ROWS FETCH FIRST #{displayCnt} ROWS ONLY
	</select>
	
	<!--계정 상태 변경  -->
	<!--E_STATUS=1 재직중일때 사용가능/ E_STATUS=2 휴직일때 사용 일시 중지/ E_STATUS=3 퇴사는 사용 중지 -->
<!-- 	<update id="">
		UPDATE EMP
		SET E_STATUS =(
	
	</update> -->
	
	
	
	
	<!--로그인 쿼리  -->
<!-- 	<select id="login" resultMap="emp">
		SELECT EMPNO
			, EPW
			, E_STATUS
		FROM EMP
		WHERE EMPNO = #{empno}
		AND EPW =#{epw}
	</select>
 -->
	
</mapper>



























